-- simple wrapper around Error_InsertError2 to omit optional parameters(mysql does not support optional parameters)

DELIMITER ;;
DROP PROCEDURE IF EXISTS Error_InsertError;
-- //
CREATE       PROCEDURE Error_InsertError(v_CompanyID NATIONAL VARCHAR(36),
 	v_DivisionID NATIONAL VARCHAR(36),
 	v_DepartmentID NATIONAL VARCHAR(36),
	v_ProcedureName NATIONAL VARCHAR(50),
 	v_Error NATIONAL VARCHAR(200),
 	INOUT v_ErrorID INT)
BEGIN
	SET @RetValue = 1;
	CALL Error_InsertError2(v_CompanyID, v_DivisionID, v_DepartmentID, v_ProcedureName, v_Error, v_ErrorID, 0, NULL, @RetValue);
		
END;;

-- Stored procedure definition script Error_InsertError2 for MySQL
-- Generated by (c) Ispirer SQLWays 4.0 Build 219 Licensed to STFB
-- Timestamp: Tue Jul 28 16:20:00 2015

DELIMITER //
DROP PROCEDURE IF EXISTS Error_InsertError2;
//
CREATE       PROCEDURE Error_InsertError2(v_CompanyID NATIONAL VARCHAR(36),
	v_DivisionID NATIONAL VARCHAR(36),
	v_DepartmentID NATIONAL VARCHAR(36),
	v_ProcedureName NATIONAL VARCHAR(50),
	v_Error NATIONAL VARCHAR(200),
	INOUT v_ErrorID INT  ,
	v_IsRaise BOOLEAN ,
	v_EmployeeID NATIONAL VARCHAR(36) ,INOUT SWP_Ret_Value INT)
   SWL_return:
BEGIN







/*
Name of stored procedure: Error_InsertError
Method: 
	Inserts an error into the error table

Date Created: EDE - 07/28/2015

Input Parameters:

	@CompanyID NVARCHAR(36)		 - the ID of the company
	@DivisionID NVARCHAR(36)	 - the ID of the division
	@DepartmentID NVARCHAR(36)	 - the ID of the department
	@ProcedureName NVARCHAR(50)	 - the
	@Error NVARCHAR(200)		 - error message
	@IsRaise BIT 			 - if @IsRaise = 1, the procedure dosn't insert record into the error table, 

							   but raise the sete of exceptions that should be processed by exteral program.

							   external programm should catch all errors and when all rollbacks related with

							   current transaction will be done, will write catched errors calling this procedure

							   with @IsRaise = 0. Such approach is used to avoid rollback of error recording 

							   when this procedure is called inside nested transactions

							   If @IsRaise = 0, procedure writes error descriptrion to the error table

Output Parameters:

	@ErrorID INT  			 - returns the ID of inserted error

Called From:

	ServiceInvoice_Post, Payment_Recalc, FixedAssetDepreciation_Post, Receipt_CopyToHistory, Purchase_Recur, RptGLCashFlowPeriodCompanyComparative, Contract_CreateOrder, RMA_Approve, RptGLCompareBalanceSheetCompanyComparative, RptGLBalanceSheetDivision, RptGLCashFlowDivisionComparative, Inventory_RecalcLIFOCost, RptGLIncomeStatementRange, RptGLPLStatementRange, Purchase_CopyAllToHistory, RptUnRealizedGainsLosses, Invoice_CreateFromOrder, RptGLIncomeStatementDivision, Payroll_Gross_Calc, InventoryAdjustments_Post, RptGLIncomeStatementPeriodCompany, Order_CreditCustomerOrder, ServiceOrder_CopyAllToHistory, Receipt_Cash, RptGLBalanceSheet, RMA_CopyToHistory, RptGLCompareBalanceSheetCompanyYTD, ServiceOrder_ServicePerformedAll, Payment_CopyToHistory, InventoryAdjustments_Cancel, RptGLIncomeStatement, DebitMemo_CreateFromMemorized, Return_Split, ReturnInvoice_CopyToHistory, Bank_CreateGLTransaction, Order_Autoship, Payroll_FICA, Return_Allocate, Payment_ApproveAll, Invoice_Post, Payroll_CreateOne, Payment_Recur, AuditLogin_CopyToHistory, ServiceInvoice_CreateFromOrder, Order_ProcessShipments, CreditMemo_CreateFromReturnInvoice, RptGLCashFlowDivision, Order_Recalc, File_Export, ServiceOrder_Post, Payroll_SUI, SerialNumber_Get, ReturnReceipt_CreateGLTransaction, RptGLTrialBalanceDivisionYTD, RptGLCashFlowPeriodDivisionYTD, RptGLBalanceSheetCompany, Receipt_CreateGLTransaction, Return_Post, RptGLBalanceSheetComparative, ServiceOrder_Split, DepreciationMethod_SumOfYears, RptGLCashFlowPeriodDivisionComparative, ServiceOrder_MakeInvoiceReceipt, RMA_Split, RptGLBalanceSheetYTD, Return_CreateAllFromMemorized, RptGLIncomeStatementDivisionYTD, RptGLTrialBalanceYTD, Inventory_Assemblies, Return_Picked, FixedAssetDisposal_Post, Payroll_Emp_Duplicate, ServiceOrder_CreateFromMemorized, Payroll_W2CodesByYear, Error_InsertError.vb, LedgerMain_PeriodEndDate, RptGLBalanceSheetPeriodCompanyComparative, DebitMemo_Cancel, LedgerTransactions_PostPayment, CustomerFinancials_ReCalc, Return_CreditVendorOrderDiscountItem, File_Import, Return_Shipped, Receiving_UpdateInventoryCosting, PaymentCheck_PostAllChecks, Payment_CreateChecks, LedgerTransactions_Reverse, Payroll_Basis_GROSS_PayrollRegisterDetail, Inventory_RecalcFIFOCost, ReceiptCash_Return_CreateGLTransaction, Project_ReCalc, Fixed_CalculateDepreciation, Order_SelectForSplit, Receipt_CreateFromInvoice, Payroll_CalcForEmployee, Order_Allocate, Contract_CreditCustomerContract, ServiceInvoice_Recalc, RptGLCashFlowPeriodComparative, Inventory_Costing, GetNextCheckNumber, Payroll_FUTA, RptGLBalanceSheetPeriodCompany, Receiving_Post, Payroll_Net_Create_Details, PaymentCheck_PrintInsert, Payroll_ItemBegBalUnmatched, ServiceOrder_Close, Bank_PostDeposit, Invoice_AllOrders, Order_CopyToHistory, Payroll_TestMinMax, RptGLBalanceSheetPeriod, Invoice_CustomerFinancialsUpdateAging, Invoice_CreateFromMemorized, DebitMemo_CopyToHistory, RptGLCashFlowCompanyComparative, Payroll_Net_Calc, Receipt_Post, RptGLIncomeStatementDivisionComparative, Purchase_CreateFromBackOrders, Return_MakeInvoiceReceipt, ServiceOrder_FulfillServiceRequestAll, ReturnInvoice_CopyAllClosedToHistory, Invoice_Control, Payroll_Agi_Calc, PayrollCheckInsert, Invoice_CopyToHistory, LedgerTransactions_PostManual, ReturnInvoice_Cancel, Inventory_CreateILTransaction, RptGLBalanceSheetPeriodComparative, RptGLIncomeStatementPeriod, Order_Shipped, Invoice_CreditMemoCreateGLTransaction, Payment_Approve, WarehouseBinPutGoods, Payroll_Agi_Create_Details, Payroll_Gross_Create_Details, Fixed_AssetDisposal, DebitMemo_CopyAllToHistory, Payroll_GROSS, Return_CreditVendorAccount, Invoice_Recalc, RMA_Recalc, CreditMemo_CreateGLTransaction, Return_ShipAll, Payroll_Agi_Create_Detail_One, DepreciationMethod_Declining, Payroll_ItemBegBalW, Invoice_AdjustCustomerFinancials, Order_Picked, Payroll_AutoPayCommission, Purchase_ApproveAll, ServiceReceipt_Post, RptGLIncomeStatementComparative, RptGLTrialBalanceComparative, ReturnReceipt_Post, ServiceOrder_Cancel, Purchase_Cancel, Payroll_FIT, ReturnInvoice_CreateFromReturn, VendorFinancials_UpdateAging, RMA_CopyAllToHistory, RMA_CreateFromInvoice, LedgerMain_VerifyPeriod, Invoice_CopyAllToHistory, ServiceReceipt_CreateGLTransaction, VendorFinancials_ReCalc, RptGLIncomeStatementPeriodDivisionYTD, PayrollCheckDelete, Purchase_Control, Receipt_CreateFromOrder, CreditMemo_CreateFromRMA, Payment_PrintCheck, CreditMemo_CopyToHistory, LedgerTransactions_CopyToHistory, RptGLIncomeStatementPeriodYTD, Contract_CreateFromOrder, DepreciationMethod_Declining150, Return_Recalc, RptGLCashFlowPeriodDivision, ReceiptCash_CreateGLTransaction, PaymentCheck_Printed, Invoice_CreateGLTransaction, Order_CreateFromQuote, RptGLCompareBalanceSheetCompany, Payroll_Net_Create_Detail_One, Order_CreateAssembly, Payroll_CreateOneForEmployee, RMA_Post, Payroll_StateWithholdingTax, LedgerTransactions_PostCOA_AllRecords, Order_InvoiceThenShip, RptGLIncomeStatementRangeYTD, Purchase_CreateFromMemorized, RptGLCashFlowCompanyYTD, ReturnInvoice_VendorFinancialsUpdateAging, Shipping_Export_FedEx, Shipping_Export_General_All, LedgerMain_PeriodDate, PopulateCurrencyInfo, ServiceOrder_CopyToHistory, WarehouseBinShipGoods, Invoice_UndoAdjustCustomerFinancials, Payroll_AppendEmployeesID, RptGLBalanceSheetDivisionYTD, Return_CopyToHistory, PaymentCheck_Post, RptGLCashFlowCompany, CreditMemo_Recalc, BankTransaction_Control, RptGLIncomeStatementYTD, Inventory_RecalcAverageCost, ServiceOrder_Recalc, Payment_CreateFromRMA, CreditMemo_CopyAllToHistory, Order_CreateFromMemorized, RMA_CreateFromMemorized, RptGLCashFlowComparative, LedgerMain_CurrentPeriod, RptGLTrialBalance, Invoice_Cancel, Payroll_ItemTotalAmount, DepreciationMethod_Straight, Payroll_Post, RptGLTrialBalanceCompany, Payment_AdjustVendorFinancials, Payment_Post, CreditMemo_CreateFromInvoice, Payroll_ItemBegBalAppend, Purchase_GetAPInvoiceDiscount, Order_ShipThenInvoice, Order_CreateFromContract, Contract_Recalc, DepreciationMethod_DoubleDecline, CreditMemo_CreateFromMemorized, Return_CreateFromMemorized, RptGLIncomeStatementCompanyYTD, Purchase_Post, RptGLIncomeStatementCompany, Inventory_Transfer, RptGLIncomeStatementPeriodCompanyYTD, ServiceReceipt_Recalc, Purchase_CreateFromOrder, Payroll_W3, Receiving_AdjustInventory, Payment_CreateFromPurchase, Payroll_CalcDetail, FinancialsRecalc, Invoice_CreateFromReturn, SerialNumber_Cancel, Invoice_AdjustInventory, Receipt_Recalc, Payroll_FedWithholdingTax, LedgerTransactions_CreateFromMemorized, Payroll_Post, Receiving_CreateGLTransaction, Payroll_CALC, ServiceOrder_FulfillServiceRequest, Customer_CreateFromVendor, Receipt_AdjustCustomerFinancials, RptGLIncomeStatementPeriodComparative, RptGLCashFlowDivisionYTD, OrderDetail_SplitToWarehouseBin, ServiceOrder_ServicePerformed, Payroll_WithholdingTax, WarehouseBinLockGoods, LedgerTransactions_CopyAllToHistory, RptGLTrialBalanceCompanyYTD, RptGLCashFlowPeriod, ReturnInvoice_CreateFromMemorized, RMA_Recur, ReturnReceipt_CreateFromInvoice, Order_PickAll, RptGLBalanceSheetPeriodCompanyYTD, PayrollCheckPrinted, Invoice_UndoAdjustInventory, FixedAssetDisposal_CreateGLTransaction, ReturnInvoice_CreateGLTransaction, ServiceInvoice_CopyToHistory, Bank_PostWithdrawal, Return_CopyAllToHistory, RptGLCashFlowYTD, Shipping_Export_FedEx_All, Receipt_CopyAllToHistory, Receipt_Cash_Auto, RptUnRealizedGainLossOnly, Vendor_CreateFromCustomer, Receiving_AdjustVendorFinancials, RMAReceiving_Post, ReturnReceipt_AdjustVendorFinancials, LedgerMain_VerifyPeriodCurrent, Purchase_DebitMemoPost, ServiceReceipt_CreateFromInvoice, Bank_PostReconciliation, Order_UpdateCosting, Payment_CreateCreditMemo, RptGLBalanceSheetDivisionComparative, Purchase_CopyToHistory, DebitMemo_CreateFromPurchase, RptGLBalanceSheetPeriodDivisionComparative, DebitMemo_Recalc, Receipt_Cash_Manual, RMA_Cancel, DebitMemo_Post, Payroll_CityWithholdingTax, Customer_CreateFromLead, LedgerTransactions_Recur, RptGLBalanceSheetCompanyYTD, ReturnInvoice_AdjustInventory, SerialNumber_Put, DebitMemo_CreateGLTransaction, GetNextEntityID, ReturnReceipt_Recalc, Purchase_Approve, Purchase_Split, RptGLBalanceSheetCompanyComparative, Invoice_CreditMemoPost, Order_CreditCustomerAccount, RMAReceiving_AdjustCustomerFinancials, Inventory_RecalcItemCost, Order_Billed, RptGLBalanceSheetPeriodYTD, RptGLIncomeStatementPeriodDivisionComparative, Payment_UpdateChecks, ServiceOrder_FulfillServiceRequesAll, ServiceInvoice_CreateFromMemorized, ServiceInvoice_CreateGLTransaction, RptGLCashFlowPeriodCompany, ServiceInvoice_CopyAllToHistory, LedgerChartsOfAccount_UpdateAccountBalancesBudget, Return_CreditVendorOrder, ReturnInvoice_Post, Payroll_Basis_GROSS, LedgerMain_PostCOA, PayrollCheck_Post, LedgerTransactions_PostCOA, AuditTrail_CopyToHistory, CustomerFinancials_UpdateAging, Payment_CopyAllToHistory, RptGLCashFlowPeriodYTD, Contract_CreateFromServiceOrder, ReturnInvoice_Recalc, Ledger_YearEndClose, Order_Split, Invoice_UndoCustomerFinancialsUpdateAging, Payroll_CalcCurrent, Purchase_Recalc, Invoice_CreateFromServiceOrder, CreditMemo_CreatePayment, Shipping_Export_General, Order_CopyAllToHistory, ReturnDetail_SplitToWarehouseBin, Payroll_Gross_Create_Detail_One, CreateObjectCopy, ReturnInvoice_CreateAllFromMemorized, RptCustomerStatement, ReturnInvoice_AdjustVendorFinancials, PaymentCheck_CreateGLTransaction, RMA_ApproveAll, RptGLIncomeStatementPeriodDivision, Payroll_Current, Return_PickAll, Payment_CreateFromMemorized, CreditMemo_Post, Customer_Statement, RptGLTrialBalanceDivision, PaymentCheck_PrintDelete, BankReconciliation_Prepare, LedgerMain_PeriodsCount, Order_Printed, ReturnReceipt_Cash, Order_Cancel, Order_MakeInvoiceReceipt, Order_CreditCustomerOrderDiscountItem, Order_ShipAll, Payroll_CalcPayDate, ReturnInvoice_CopyAllToHistory, RptGLTrialBalanceDivisionComparative, PaymentCheck_Run, Order_Post, Invoice_AllServiceOrders, RptGLCashFlowPeriodCompanyYTD, Invoice_AllReturns, RptGLIncomeStatementPeriodCompanyComparative, Payroll_ItemsRecur, Ledger_PeriodEndClose, RptGLPLStatement, RptGLTrialBalanceCompanyComparative, RMAReceiving_CreateGLTransaction, ServiceInvoice_CopyAllClosedToHistory, RptGLBalanceSheetPeriodDivision, RptGLIncomeStatementRangeComparative, InventoryAdjustments_CreateGLTransaction, Purchase_CreateFromReorder, RptGLIncomeStatementCompanyComparative, Bank_PostTransfer, Return_Cancel, ServiceInvoice_Cancel, RptGLCashFlow, RptGLBalanceSheetPeriodDivisionYTD, Receipt_CreateFromMemorized, FixedAssetDepreciation_CreateGLTransaction, DebitMemo_ApplyToPayment, Payment_CreateGLTransaction, Payroll_BegBalYTDUpdate

Calls:

	NONE

Last Modified: 

Last Modified By: 

Revision History: 

*/

   DECLARE v_Context VARBINARY(128);
   DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
   BEGIN
      SET @SWV_Error = 1;
   END;
   IF v_IsRaise is null then
      set v_IsRaise = 1;
   END IF;
   IF v_EmployeeID is null then
      set v_EmployeeID = '';
   END IF;
   SET @SWV_Error = 0;
   IF v_IsRaise = 1 then
	
		
      select   context_info INTO v_Context FROM sysprocesses WHERE spid = CONNECTION_ID();
      SET v_EmployeeID = CAST(v_Context AS CHAR(36));
      -- Not supported RAISERROR (@Error, 16, 10);
-- Not supported RAISERROR (@CompanyID, 16, 11);
-- Not supported RAISERROR (@DivisionID, 16, 12);
-- Not supported RAISERROR (@DepartmentID, 16, 13);
-- Not supported RAISERROR (@ProcedureName, 16, 14);
-- Not supported RAISERROR (@EmployeeID, 16, 15);
ELSE
		-- Insert the error data into the error log
      SET @SWV_Error = 0;
      INSERT INTO ErrorLog(CompanyID,
			DivisionID,
			DepartmentID,
			EmployeeID,
			ErrorDate,
			ErrorTime,
			ScreenName,
			ModuleName,
			ErrorCode,
			ErrorMessage)
		VALUES(v_CompanyID,
			v_DivisionID,
			v_DepartmentID,
			v_EmployeeID,
			CURRENT_TIMESTAMP,
			CURRENT_TIMESTAMP,
			NULL,
			v_ProcedureName,
			NULL,
			v_Error);
		
		-- If an error occurs, return -1
		
      IF @SWV_Error <> 0 then
		
         SET SWP_Ret_Value = -1;
         LEAVE SWL_return;
      end if;
      SET v_ErrorID = IDENT_CURRENT('ErrorLog');
   end if;


   SET SWP_Ret_Value = 0;
END;



















//

DELIMITER ;
